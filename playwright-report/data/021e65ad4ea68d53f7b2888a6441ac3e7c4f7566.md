# Test info

- Name: Organization Management Flow >> should use organization context for exercise generation
- Location: /Users/joshuaramat/Developer/HEP-companion/tests/integration/organizations/organization-flow.spec.ts:120:7

# Error details

```
Error: expect(received).toBe(expected) // Object.is equality

Expected: "CLINIC-1"
Received: ""
    at /Users/joshuaramat/Developer/HEP-companion/tests/integration/organizations/organization-flow.spec.ts:140:30
```

# Page snapshot

```yaml
- banner:
  - navigation: HEP Companion User Menu
- main:
  - heading "Generate Exercises" [level=1]
  - text: Clinical Scenario
  - textbox "Clinical Scenario"
  - text: Patient MRN
  - textbox "Patient MRN"
  - text: Clinic ID
  - textbox "Clinic ID"
  - button "Generate"
- text: Login successful Organization Test Clinic selected generate
```

# Test source

```ts
   40 |     
   41 |     // Verify results
   42 |     const orgCount = await organizationPage.getOrganizationCount();
   43 |     expect(orgCount).toBeGreaterThan(0);
   44 |     
   45 |     // Verify organization names returned
   46 |     const orgNames = await organizationPage.getOrganizationNames();
   47 |     expect(orgNames.length).toBeGreaterThan(0);
   48 |     expect(orgNames.some(name => name.includes('Clinic'))).toBeTruthy();
   49 |   });
   50 |   
   51 |   test('should handle search validation and error states', async ({ page }) => {
   52 |     const organizationPage = new OrganizationPage(page);
   53 |     await organizationPage.goto();
   54 |     
   55 |     // Test 1: Search with query that's too short
   56 |     await organizationPage.searchInput.fill('a');
   57 |     await organizationPage.searchButton.click();
   58 |     
   59 |     // Verify error message
   60 |     expect(await organizationPage.hasError()).toBeTruthy();
   61 |     
   62 |     // Test 2: Search for nonexistent organization
   63 |     await organizationPage.searchOrganizations('nonexistent');
   64 |     
   65 |     // Verify no results message
   66 |     expect(await organizationPage.hasNoResults()).toBeTruthy();
   67 |   });
   68 |
   69 |   test('should select an organization and update application state', async ({ page }) => {
   70 |     const organizationPage = new OrganizationPage(page);
   71 |     await organizationPage.goto();
   72 |     
   73 |     // Search for organizations
   74 |     await organizationPage.searchOrganizations('clinic');
   75 |     
   76 |     // Select the first organization
   77 |     await organizationPage.selectOrganization(0);
   78 |     
   79 |     // Verify organization selection UI
   80 |     const selectedOrg = await organizationPage.getSelectedOrganization();
   81 |     expect(selectedOrg).toBeTruthy();
   82 |     
   83 |     // Verify organization state was updated
   84 |     const orgState = await organizationPage.getSelectedOrganizationState();
   85 |     expect(orgState).toBeTruthy();
   86 |     expect(orgState.id).toBeTruthy();
   87 |     expect(orgState.name).toBeTruthy();
   88 |     expect(orgState.clinic_id).toBeTruthy();
   89 |   });
   90 |   
   91 |   test('should persist selected organization across navigation', async ({ page }) => {
   92 |     const organizationPage = new OrganizationPage(page);
   93 |     const dashboardPage = new DashboardPage(page);
   94 |     
   95 |     // First select an organization
   96 |     await organizationPage.goto();
   97 |     await organizationPage.searchOrganizations('clinic');
   98 |     await organizationPage.selectOrganization(0);
   99 |     
  100 |     // Store the selected organization info
  101 |     const selectedOrgState = await organizationPage.getSelectedOrganizationState();
  102 |     const selectedOrgName = selectedOrgState.name;
  103 |     
  104 |     // Navigate to dashboard
  105 |     await dashboardPage.goto();
  106 |     
  107 |     // Verify organization is still selected
  108 |     const dashboardOrgName = await dashboardPage.getCurrentOrganization();
  109 |     expect(dashboardOrgName).toContain(selectedOrgName);
  110 |     
  111 |     // Navigate back to organization page
  112 |     await dashboardPage.goToOrganizations();
  113 |     
  114 |     // Verify org is still selected
  115 |     const currentOrgState = await organizationPage.getSelectedOrganizationState();
  116 |     expect(currentOrgState.id).toBe(selectedOrgState.id);
  117 |     expect(currentOrgState.name).toBe(selectedOrgState.name);
  118 |   });
  119 |   
  120 |   test('should use organization context for exercise generation', async ({ page }) => {
  121 |     const organizationPage = new OrganizationPage(page);
  122 |     const dashboardPage = new DashboardPage(page);
  123 |     const generatePage = new GeneratePage(page);
  124 |     
  125 |     // First select an organization
  126 |     await organizationPage.goto();
  127 |     await organizationPage.searchOrganizations('clinic');
  128 |     await organizationPage.selectOrganization(0);
  129 |     
  130 |     // Get the clinic ID from the selected organization
  131 |     const orgState = await organizationPage.getSelectedOrganizationState();
  132 |     const clinicId = orgState.clinic_id;
  133 |     
  134 |     // Navigate to generate page
  135 |     await dashboardPage.goto();
  136 |     await dashboardPage.goToGenerateExercises();
  137 |     
  138 |     // Verify the clinic ID is pre-filled in the form
  139 |     const clinicInputValue = await generatePage.clinicIdInput.inputValue();
> 140 |     expect(clinicInputValue).toBe(clinicId);
      |                              ^ Error: expect(received).toBe(expected) // Object.is equality
  141 |   });
  142 | }); 
```